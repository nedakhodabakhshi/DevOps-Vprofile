version: 0.2
phases:
  install:
    runtime-versions:
      java: corretto11 
    commands:
      - echo Updating package lists...
      - apt-get update -y
      - echo Installing Maven...
      - apt-get install -y maven
  pre_build:
    commands:
      - echo Preparing environment variables...
      - export DB_HOST=vp-rds-instance.c1u4si4autpe.us-east-1.rds.amazonaws.com
      - export DB_USERNAME=admin
      - export DB_PASSWORD=RdsDatabase123
      - export MEMCACHED_ACTIVE_HOST=cl-vp-97lvxt1i008y.9tytbr.cfg.use1.cache.amazonaws.com
      - export RABBITMQ_ADDRESS=b-b80e35f3-50ee-41f9-9771-f2303c1e485f-1.mq.us-east-1.amazonaws.com
  build:
    commands:
      - echo Importing database backup...
      - mysql -h $DB_HOST -u $DB_USERNAME -p$DB_PASSWORD accounts < db_backup.sql
  post_build:
    commands:
      - echo Database import completed successfully.
artifacts:
  files:
    - db_backup.sql
